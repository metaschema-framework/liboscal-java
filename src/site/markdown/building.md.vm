# Building from Source

This guide explains how to build ${project.name} from source code.

## Prerequisites

| Requirement | Minimum Version | Notes |
|:------------|:----------------|:------|
| Java JDK    | 17              | Required for building (output JARs are JDK 11 compatible) |
| Maven       | 3.9.0           | Required for building |
| Git         | 2.0             | Required for cloning |

Ensure `JAVA_HOME` is set correctly:

```bash
# Linux/macOS
export JAVA_HOME=$(/usr/libexec/java_home -v 17)

# Windows
set JAVA_HOME=C:\Program Files\Java\jdk-17
```

## Clone the Repository

Clone the repository with submodules:

```bash
git clone --recurse-submodules https://github.com/metaschema-framework/liboscal-java.git
cd liboscal-java
```

If you already cloned without submodules, initialize them:

```bash
git submodule update --init --recursive
```

## Build Commands

### Basic Build

Build and install to your local Maven repository:

```bash
mvn install
```

### Run Tests Only

```bash
mvn test
```

### Run a Single Test

```bash
# Run a single test class
mvn test -Dtest=ExamplesTest

# Run a single test method
mvn test -Dtest=ExamplesTest#testExample
```

### Skip Tests

```bash
mvn install -DskipTests
```

### CI/CD Build

Replicate the full CI/CD build (recommended before pushing):

```bash
mvn install -PCI -Prelease
```

This enables additional checks including:
- License header verification
- Code style checks
- Full test suite

## Code Quality Commands

### Check License Headers

```bash
mvn license:check
```

### Auto-format Source Code

```bash
mvn formatter:format
```

### Check for Checkstyle Issues

```bash
mvn checkstyle:check
```

## Common Build Issues

### Submodule Not Initialized

**Symptom:** Build fails with missing OSCAL schema files.

**Solution:** Initialize submodules:

```bash
git submodule update --init --recursive
```

### Java Version Mismatch

**Symptom:** Compilation errors or "unsupported class file version" errors.

**Solution:** Ensure you're using Java 17 or later for building (required due to build plugin requirements):

```bash
java -version
mvn -version
```

### Maven Version Too Old

**Symptom:** Build fails with plugin compatibility errors.

**Solution:** Upgrade Maven to 3.9.0 or later. Check your version:

```bash
mvn -version
```

### Out of Memory

**Symptom:** Build fails with `OutOfMemoryError`.

**Solution:** Increase Maven's heap size:

```bash
export MAVEN_OPTS="-Xmx2g"
mvn install
```

### License Header Check Fails

**Symptom:** Build fails during `license:check` phase.

**Solution:** Run the formatter to add missing headers:

```bash
mvn license:format
```

## Building the Site

To build the project documentation site:

```bash
mvn install site -DskipTests
```

**Note:** The `install` and `site` goals must run together in a single Maven invocation. This is required because the Javadoc plugin needs access to the generated OSCAL model classes, which are only available after the `install` phase completes within the same Maven session.

Running `mvn site` alone will fail with Javadoc errors about missing model classes.

## Generated Sources

OSCAL model classes are generated during the build from Metaschema definitions in the `oscal/` submodule. These generated classes appear in:

```
target/generated-sources/metaschema/
```

If you make changes to the OSCAL Metaschema modules, run a clean build:

```bash
mvn clean install
```

## Contributing

For contribution guidelines, including code style requirements and the pull request process, see [CONTRIBUTING.md](https://github.com/metaschema-framework/liboscal-java/blob/develop/CONTRIBUTING.md).

## Next Steps

Once you've built the project, explore these resources to start using the library:

- [Installation](installation.html) - Add the library to your project
- [Architecture](guides/architecture.html) - Understand the library structure
